name: Upload to Dataverse

on:
  push:
    branches:
      - main  
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      # Verify Dataverse connection and API token
      - name: Verify Dataverse connection
        run: |
          echo "Verifying Dataverse API connection..."
          curl -H "X-Dataverse-key: ${{ secrets.DATAVERSE_TOKEN }}" https://darus.uni-stuttgart.de/api/dataverses/darus

      - name: Send repo to Dataverse
        uses: IQSS/dataverse-uploader@v1.6
        with:
          DATAVERSE_TOKEN: ${{ secrets.DATAVERSE_TOKEN }}
          DATAVERSE_SERVER: https://darus.uni-stuttgart.de/dataverse/darus
          DATAVERSE_DATASET_DOI: doi:10.18419/DARUS-5297
          ACTION: "add"